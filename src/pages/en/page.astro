---
import '../../styles/global1.css';
import UserManagementContentanglais from '../../components/UserManagementContentanglais.astro';
import ContactContentanglais from '../../components/ContactContentanglais.astro';
import ProduitsContentanglais from '../../components/ProduitsContentanglais.astro';
import AchatsContentanglais from '../../components/AchatsContentanglais.astro';
import VenteContentanglais from '../../components/VenteContentanglais.astro';
import TransfertsContentanglais from '../../components/TransfertsContentanglais.astro';
import AjustementsContentanglais from '../../components/AjustementsContentanglais.astro';
import DepenseContentanglais from '../../components/DepenseContentanglais.astro';
import ModelesContentanglais from '../../components/ModelesContentanglais.astro';
import ParametresContentanglais from '../../components/ParametresContentanglais.astro';
import RapportsContentanglais from '../../components/RapportsContentanglais.astro';

const title = 'Documentation';
const currentPage = 'user';
---

<!-- Client-side script loading only -->
<script>
   import '../../scripts/en/main.js';
</script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <a href="/" class="logo">
          <div class="logo">
            <img src="/images/logo.png" alt="Movelys Logo" style="height:70px; vertical-align:middle;" />
          </div> 
        </a>
        <nav class="nav">
            <div class="search-bar">
          <input type="text" id="searchInput" placeholder="Search..." />
          <button id="searchButton" aria-label="Search">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
          </button>
        </div>
            <a href="https://github.com/zamboukenfack/reproduction4" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 .5C5.73.5.5 5.74.5 12.02c0 5.1 3.29 9.43 7.86 10.96.58.11.79-.25.79-.56 0-.28-.01-1.02-.02-2-3.2.7-3.88-1.54-3.88-1.54-.53-1.35-1.29-1.71-1.29-1.71-1.06-.72.08-.7.08-.7 1.17.08 1.79 1.2 1.79 1.2 1.04 1.78 2.73 1.27 3.4.97.1-.75.4-1.27.72-1.56-2.56-.29-5.26-1.28-5.26-5.7 0-1.26.45-2.3 1.19-3.11-.12-.29-.52-1.47.11-3.06 0 0 .97-.31 3.17 1.18.92-.26 1.9-.39 2.88-.39.98 0 1.96.13 2.88.39 2.19-1.49 3.16-1.18 3.16-1.18.63 1.59.23 2.77.12 3.06.74.81 1.19 1.85 1.19 3.11 0 4.43-2.7 5.4-5.28 5.68.41.35.77 1.05.77 2.13 0 1.54-.01 2.77-.01 3.15 0 .31.21.68.8.56 4.57-1.53 7.85-5.86 7.85-10.96C23.5 5.74 18.27.5 12 .5z"/>
                </svg>
            </a>
            <div class="header-actions">
         
                <button id="themeToggle" class="icon-button" title="Changer de thème">
                <span id="themeIcon">🌙</span>
                </button>
        </nav>
    </header>

    <div id="not-found-msg" style="display:none; color:red; font-weight:bold; margin:16px 0; font-size:1rem; text-align:center;">
        word not found
        
    </div>

    <div class="page-container">
        <!-- Left section -->
        <section class="section left-section">
            <aside class="sidebar">
                <nav class="sidebar-nav">
                    <a href="#" data-page="user" class="sidebar-link active">User Management</a>
                    <a href="#" data-page="contact" class="sidebar-link">Contact</a>
                    <a href="#" data-page="Products" class="sidebar-link">Products</a>
                    <a href="#" data-page="Purchases" class="sidebar-link">Purchases</a>
                    <a href="#" data-page="sales" class="sidebar-link">Sell</a>
                    <a href="#" data-page="Transfers" class="sidebar-link">Stock Transfers</a>
                    <a href="#" data-page="Adjustments" class="sidebar-link">Stock Adjustments</a>
                    <a href="#" data-page="Expense" class="sidebar-link">Expense</a>
                    <a href="#" data-page="Reports" class="sidebar-link">Reports</a>
                    <a href="#" data-page="Templates" class="sidebar-link">Notification Templates</a>
                    <a href="#" data-page="Settings" class="sidebar-link">Settings</a>
                </nav>
            </aside>
        </section>

        <!-- Central section (wider) -->
        <section class="section middle-section" id="content-area">
            <div id="astro-content-user">
                <UserManagementContentanglais />
            </div>
            <div id="astro-content-contact" style="display:none">
                <ContactContentanglais />
            </div>
            <div id="astro-content-products" style="display:none">
                <ProduitsContentanglais />
            </div>
            <div id="astro-content-purchases" style="display:none">
                <AchatsContentanglais />
            </div>
            <div id="astro-content-sales" style="display:none">
                <VenteContentanglais />
            </div>
            <div id="astro-content-transfers" style="display:none">
                <TransfertsContentanglais />
            </div>
            <div id="astro-content-adjustments" style="display:none">
                <AjustementsContentanglais />
            </div>
            <div id="astro-content-expense" style="display:none">
                <DepenseContentanglais />
            </div>
            <div id="astro-content-templates" style="display:none">
                <ModelesContentanglais />
            </div>
            <div id="astro-content-settings" style="display:none">
                <ParametresContentanglais />
            </div>
            <div id="astro-content-reports" style="display:none">
                <RapportsContentanglais />
            </div>
        </section>

        <!-- Right section -->
        <section class="section right-section" id="right-section">
         <h2>On this page</h2>
           <!-- The table of contents will be generated here -->
        </section>
    </div>

    <footer class="site-footer">
    <div class="footer-content">
        <!-- Logo or Name -->
        <h2>Movelys Documentation</h2>

        <!-- Separator -->
        <hr>

        <!-- Text -->
        <p>© 2025 Movelys — All rights reserved.</p>
        <p>Designed for simple, fluid and professional business management.</p>
    </div>
</footer>

    <script type="module">
        // Handles central content change and TOC
        document.addEventListener('DOMContentLoaded', () => {
            const links = document.querySelectorAll('.sidebar-link');
            const contentUser = document.getElementById('astro-content-user');
            const contentContact = document.getElementById('astro-content-contact');
            const contentProducts = document.getElementById('astro-content-products');
            const contentPurchases = document.getElementById('astro-content-purchases');
            const contentSales = document.getElementById('astro-content-sales');
            const contentTransfers = document.getElementById('astro-content-transfers');
            const contentAdjustments = document.getElementById('astro-content-adjustments');
            const contentExpense = document.getElementById('astro-content-expense');
            const contentTemplates = document.getElementById('astro-content-templates');
            const contentSettings = document.getElementById('astro-content-settings');
            const contentReports = document.getElementById('astro-content-reports');
            
            function showContent(page) {
                // First hide all contents
                contentUser.style.display = 'none';
                contentContact.style.display = 'none';
                contentProducts.style.display = 'none';
                contentPurchases.style.display = 'none';
                if (contentSales) contentSales.style.display = 'none';
                if (contentTransfers) contentTransfers.style.display = 'none';
                if (contentAdjustments) contentAdjustments.style.display = 'none';
                if (contentExpense) contentExpense.style.display = 'none';
                if (contentTemplates) contentTemplates.style.display = 'none';
                if (contentSettings) contentSettings.style.display = 'none';
                if (contentReports) contentReports.style.display = 'none';
                
                // Show only the requested content
                if (page === 'user') {
                    contentUser.style.display = '';
                } else if (page === 'contact') {
                    contentContact.style.display = '';
                } else if (page === 'Products') {
                    contentProducts.style.display = '';
                } else if (page === 'Purchases') {
                    contentPurchases.style.display = '';
                } else if (page === 'sales' && contentSales) {
                    contentSales.style.display = '';
                } else if (page === 'Transfers' && contentTransfers) {
                    contentTransfers.style.display = '';
                } else if (page === 'Adjustments' && contentAdjustments) {
                    contentAdjustments.style.display = '';
                } else if (page === 'Expense' && contentExpense) {
                    contentExpense.style.display = '';
                } else if (page === 'Templates' && contentTemplates) {
                    contentTemplates.style.display = '';
                } else if (page === 'Settings' && contentSettings) {
                    contentSettings.style.display = '';
                } else if (page === 'Reports' && contentReports) {
                    contentReports.style.display = '';
                }
                
                // Generate the TOC after content change
                if (window.generateTOC) window.generateTOC();
            }
            links.forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    links.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    showContent(link.dataset.page);
                });
            });
            // Generate the TOC on initial load
            if (window.generateTOC) window.generateTOC();
        });

    // ...dans <script type="module">...
document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.getElementById('searchInput');
  const contentArea = document.getElementById('content-area');
  const notFoundMsg = document.getElementById('not-found-msg');

  function getVisibleContentDiv() {
    // Sélectionne le premier div enfant visible dans la section centrale
    return Array.from(contentArea.children).find(
      div => div.style.display !== 'none'
    );
  }

  function removeHighlights(target) {
    if (!target) return;
    // On retire tous les <mark class="highlight">
    const highlights = target.querySelectorAll('mark.highlight');
    highlights.forEach(mark => {
      const parent = mark.parentNode;
      parent.replaceChild(document.createTextNode(mark.textContent), mark);
      parent.normalize();
    });
  }

  function highlightTerm(target, term) {
    if (!target || !term) return 0;
    let count = 0;
    const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');

    function walk(node) {
      if (node.nodeType === 3) { // Text node
        const matches = node.nodeValue.match(regex);
        if (matches) {
          count += matches.length;
          const span = document.createElement('span');
          span.innerHTML = node.nodeValue.replace(regex, '<mark class="highlight">$1</mark>');
          node.parentNode.replaceChild(span, node);
        }
      } else if (node.nodeType === 1 && node.nodeName !== 'SCRIPT' && node.nodeName !== 'STYLE') {
        // Ne pas traiter les balises script/style
        Array.from(node.childNodes).forEach(walk);
      }
    }
    walk(target);
    return count;
  }

  function handleSearch() {
    const visibleDiv = getVisibleContentDiv();
    notFoundMsg.style.display = 'none';
    if (!visibleDiv) return;
    removeHighlights(visibleDiv);
    const term = searchInput.value.trim();
    if (term.length > 0) {
      const found = highlightTerm(visibleDiv, term);
      if (found === 0) {
        notFoundMsg.style.display = 'block';
      }
    }
  }

  searchInput.addEventListener('input', handleSearch);

  // Pour que la recherche fonctionne lors du changement de section
  const sidebarLinks = document.querySelectorAll('.sidebar-link');
  sidebarLinks.forEach(link => {
    link.addEventListener('click', () => {
      setTimeout(handleSearch, 50); // attend que le contenu soit affiché
    });
  });
});



document.addEventListener('DOMContentLoaded', () => {
  const themeToggle = document.getElementById('themeToggle');
  const themeIcon = document.getElementById('themeIcon');
  const root = document.documentElement;

  // Appliquer le thème sauvegardé ou par défaut
  function applyTheme(theme) {
    if (theme === 'dark') {
      root.classList.add('dark-theme');
      root.classList.remove('light-theme');
      if (themeIcon) themeIcon.textContent = '☀️';
    } else {
      root.classList.remove('dark-theme');
      root.classList.add('light-theme');
      if (themeIcon) themeIcon.textContent = '🌙';
    }
  }

  // Initialisation au chargement
  let theme = localStorage.getItem('theme') || 'light';
  applyTheme(theme);

  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      theme = (theme === 'light') ? 'dark' : 'light';
      localStorage.setItem('theme', theme);
      applyTheme(theme);
    });
  }
});

    </script>
   <script type="module" src="/src/scripts/en/main.js"></script>
</body>
</html>
